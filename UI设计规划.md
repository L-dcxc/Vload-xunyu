# UI设计规划（电子负载上位机 / PyQt）

## 1. 设计目标

- 现代应用风格（Modern Desktop App）
- 可扩展为多设备同时连接与监控（每台设备单通道）
- 操作明确、降低误操作：所有控制动作必须清晰指向“当前设备”
- 重点突出：读数可视化、状态可见、日志可追溯
- 易扩展：后续增加 DYN/LIST/OCP/Timing 等高级页不破坏整体布局

## 2. 全局布局（当前实现形态）

主窗口：`QMainWindow`

- 顶部：标题与连接状态栏（软件名/Logo/设备信息/连接状态灯/地址）
- 中间：主工作区（按页面切换）
  - 监控：左侧控制区 + 中央曲线图
  - 任务序列：序列编辑与执行
  - 模板库：模板选择与说明预览
  - 数据与日志：数据表/运行日志/通信日志/SCPI终端

布局示意（线框）：

```text
┌─────────────────────────────────────────────────────────────────────┐
│ Header: [LOGO] 电子负载上位机   设备：{Model} ID:{ID}  ●{Status}  地址:{Addr}│
├─────────────────────────────────────────────────────────────────────┤
│ Tabs: 监控 | 任务序列 | 模板库 | 数据与日志                            │
├─────────────────────────────────────────────────────────────────────┤
│ Page Content (Stacked)                                              │
│ - 监控：左侧控制区 + 中央图表区                                      │
│ - 序列：序列表格与执行按钮                                           │
│ - 模板：模板列表 + 说明预览 + 应用到序列                             │
│ - 数据与日志：数据表/运行日志/通信日志/SCPI终端 Tabs                 │
└─────────────────────────────────────────────────────────────────────┘
```

## 3. 设备（可扩展）

当前实现默认按“单设备/单窗口”使用（可通过多开上位机同时控制多台设备）。

后续如需“多设备并行控制”，可以扩展为左侧设备卡片网格作为上下文切换入口。

### 3.1 设备卡片内容（后续扩展）

- 别名（Alias，可编辑）
- 连接方式：TCP / COM
- 地址摘要：`IP:PORT` 或 `COMx@baud`
- 状态：Connected / Disconnected / Error / Busy（用小圆点 + 文本）
- 小读数预览（可选但推荐）：`V / I / P`（低频刷新）

### 3.2 交互规则

- 单击卡片：切换当前设备上下文
- 双击卡片：进入该设备的“监控”页
- 右键菜单：
  - Connect / Disconnect
  - Rename
  - Edit Config（编辑连接参数）
  - Remove
  - Export Log

### 3.3 多设备并行策略（UI 侧）

- 多设备形态下：
  - 非当前设备只做“只读预览”（V/I/P 低频轮询）
  - 只有当前设备页面内控件可编辑，其他设备无页面控制入口
  - 切换设备时：主工作区内容切换到新设备的状态与参数，同时切换该设备的日志与终端上下文

## 4. 页面规划（信息架构）

页面采用 `QTabWidget` + `QStackedWidget` 思路管理，通过顶部 Tab 切换。

### 4.1 监控（默认页 / 核心页）

目标：一眼看连接状态/模式/读数/趋势，并能完成基础启停控制。

- 顶部标题与状态栏
  - 软件名称、Logo、设备型号与ID
  - 连接状态灯（绿=已连接/红=未连接）
  - 地址显示（IP:Port 或 COM@Baud）
- 左侧设备控制区
  - 模式选择：恒流(CC) / 恒压(CV) / 恒功率(CP) / 恒电阻(CR)
  - 参数设置：设定值、保护阈值（如 OCP/OPP）
  - 实时监控：电压/电流/功率/内阻（大字）
  - 启停控制：START / STOP / 紧急停止
- 中央曲线图表区
  - 推荐组件：`pyqtgraph`
  - 默认三曲线叠加：V/I/P
  - 显示/隐藏：复选框或图例控制
  - 交互：缩放/平移
  - 控件：暂停更新、清空曲线
  - 标记点：点击曲线区域显示该点时间与数值

### 4.2 任务序列

- 序列编辑器：表格形式编辑多步序列（步骤/模式/设定值/持续时间/备注）
- 序列控制：加载、保存、开始执行、停止
- 备注：第一阶段可先完成 UI 与数据结构，占位实现

### 4.3 模板库

- 模板列表：内置常用模板（例如电池容量测试、电源动态响应等）
- 模板说明：右侧预览说明与关键参数提示
- 应用到序列：一键生成/覆盖到“任务序列”页（第一阶段可先做 UI 占位）

### 4.4 数据与日志

以页内 Tabs 组织：
- 数据表格：实时滚动显示带时间戳的数据；提供导出 CSV/Excel 按钮
- 运行日志：记录用户操作、状态变化、错误信息（如保护触发）
- 通信日志：记录 TX/RX/ERR 原始报文（用于定位问题）
- SCPI 终端：手工发送命令并显示回包

约束：
- 终端与通信日志永远作用于“当前连接设备”
- 所有发送/回包必须可追溯（至少显示时间戳与方向）

### 4.5 设置（后续页）

- 默认 TCP 端口、默认串口参数
- 超时/重试策略
- 主题（亮/暗）
- 日志级别/保存路径

## 6. 视觉规范（青绿色现代主题）

### 6.1 主题建议

- 暗色为主（推荐），亮色可选
- 主强调色：青绿色（用于按钮主色、选中态、TX）
- 告警色：橙（警告）、红（严重）

建议色值（可在 QSS 中统一定义变量，或集中管理）：
- Accent（青绿）：`#22C6A8`
- Accent Hover：`#31D7B8`
- Background：`#0F141A`
- Surface/Card：`#161D26`
- Border：`#243040`
- Text Primary：`#E6EDF3`
- Text Secondary：`#9AA7B2`
- Warning：`#F59E0B`
- Danger：`#EF4444`

### 6.2 字体与间距

- 主数值：28~36px（监控页读数/关键指标）
- 普通文本：12~14px
- 统一圆角：8~12px
- 卡片内边距：12~16px
- 卡片间距：12px

### 6.3 控件样式策略

- 少用传统 GroupBox 边框
- 多用 Card（圆角 + 轻边框/层次）
- 主要按钮统一主色（青绿），次要按钮用中性灰

## 7. 交互与状态管理规范

- 当前设备上下文：
  - 主工作区顶部固定显示：`当前设备：{Alias} ({Addr})` + 状态
- 控件置灰规则：
  - 未连接：除连接相关控件外，其余全部置灰
  - 正在执行长任务（如 OCP/Timing）：相关配置控件置灰，避免中途变参
- 错误提示：
  - 轻量错误：状态栏提示 + 日志记录
  - 严重错误（超时/断链）：弹窗提示 + 自动切换设备状态为 Error

## 8. 实现建议（PyQt 技术选型，供落地时参考）

- 主题：优先 `qdarktheme`（省 QSS 工作量），再按需要微调 accent
- 图标：`qtawesome`
- 曲线：`pyqtgraph`
- 页面组织：
  - 顶部：状态栏组件（HeaderBar）
  - 主区：`QTabWidget`（监控/任务序列/模板库/数据与日志）
  - 页面内容：使用可复用面板组件拆分（ControlPanel / PlotPanel / SequencePanel / TemplatePanel / DataLogPanel）

## 9. MVP UI 验收点

- 监控页可完成：连接/断开、模式选择、设定值输入、START/STOP/紧急停止入口
- 中央曲线区可完成：V/I/P 显示/隐藏、缩放平移、暂停、清空、标记点读数
- 任务序列页可编辑表格并可保存/加载入口（第一阶段可先占位）
- 模板库页可查看模板说明并有“应用到序列”入口（第一阶段可先占位）
- 数据与日志页具备：数据表滚动、运行日志、通信日志、SCPI 终端
